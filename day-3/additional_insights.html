<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hot Cocoa Championship - Additional Insights</title>
    <link rel="stylesheet" href="common.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }
        .container {
            max-width: 1600px;
        }
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }
        .chart-wrapper {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            color: #444;
        }
        .full-width {
            grid-column: 1 / -1;
        }
        .treemap-cell {
            stroke: #fff;
            stroke-width: 2px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .treemap-cell:hover {
            opacity: 0.8;
        }
        .treemap-label {
            pointer-events: none;
            font-size: 12px;
            font-weight: bold;
            fill: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        .treemap-value {
            pointer-events: none;
            font-size: 10px;
            fill: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }
        .summary-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .summary-box h3 {
            margin-top: 0;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .summary-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 5px;
            backdrop-filter: blur(10px);
        }
        .summary-item h4 {
            margin: 0 0 10px 0;
            font-size: 16px;
        }
        .summary-item p {
            margin: 5px 0;
            font-size: 14px;
        }
        .chord-path {
            fill-opacity: 0.67;
            stroke: #000;
            stroke-width: 0.5px;
        }
        .chord-path:hover {
            fill-opacity: 0.9;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-button">‚Üê Back to Home</a>
        <h1>üîç Hot Cocoa Championship - Deep Dive Insights</h1>
        <p class="subtitle">Comprehensive analysis of tournament dynamics and patterns</p>
        
        <div class="charts-container">
            <div class="chart-wrapper full-width">
                <div class="chart-title">Tournament Hierarchy - Treemap Visualization</div>
                <div id="treemap"></div>
            </div>
            
            <div class="chart-wrapper">
                <div class="chart-title">Vote Momentum Through Rounds</div>
                <div id="momentum"></div>
            </div>
            
            <div class="chart-wrapper">
                <div class="chart-title">Score Profile Distribution</div>
                <div id="score-distribution"></div>
            </div>
            
            <div class="chart-wrapper">
                <div class="chart-title">Voting Time Period Trends</div>
                <div id="time-trend"></div>
            </div>
            
            <div class="chart-wrapper">
                <div class="chart-title">Match Competitiveness Analysis</div>
                <div id="competitiveness"></div>
            </div>
        </div>

        <div class="summary-box">
            <h3>üìà Tournament Analytics Summary</h3>
            <div class="summary-grid">
                <div class="summary-item">
                    <h4>üèÜ Winner Analysis</h4>
                    <p><strong>Dark Chocolate Decadence</strong></p>
                    <p>‚Ä¢ 1,466 total votes (27.7%)</p>
                    <p>‚Ä¢ Won all 3 matches</p>
                    <p>‚Ä¢ Average margin: +77 votes</p>
                    <p>‚Ä¢ Key strength: Richness & Presentation</p>
                </div>
                
                <div class="summary-item">
                    <h4>üìä Voting Patterns</h4>
                    <p>‚Ä¢ Peak period: Evening (40.7%)</p>
                    <p>‚Ä¢ Total turnout: 5,294 votes</p>
                    <p>‚Ä¢ Most competitive: QF Match 2</p>
                    <p>‚Ä¢ Biggest upset: None (favorites won)</p>
                </div>
                
                <div class="summary-item">
                    <h4>üéØ Recipe Profiles</h4>
                    <p>‚Ä¢ Most balanced: Cinnamon Fireside</p>
                    <p>‚Ä¢ Highest single score: DCD (10/10 x2)</p>
                    <p>‚Ä¢ Most creative: Spicy Mexican Mocha</p>
                    <p>‚Ä¢ Sweetest: White Chocolate Wonder</p>
                </div>
                
                <div class="summary-item">
                    <h4>üí° Key Takeaways</h4>
                    <p>‚Ä¢ Rich > Sweet in voting preferences</p>
                    <p>‚Ä¢ Presentation matters significantly</p>
                    <p>‚Ä¢ Evening voters more engaged</p>
                    <p>‚Ä¢ Excellence beats balance</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Comprehensive tournament data
        const hierarchyData = {
            name: "Hot Cocoa Championship",
            children: [
                {
                    name: "Champion",
                    children: [
                        {name: "Dark Chocolate Decadence", value: 1466, category: "champion"}
                    ]
                },
                {
                    name: "Runner-Up",
                    children: [
                        {name: "Peppermint Dream", value: 1380, category: "finalist"}
                    ]
                },
                {
                    name: "Semi-Finals Eliminated",
                    children: [
                        {name: "Classic Swiss Velvet", value: 632, category: "semifinal"},
                        {name: "Cinnamon Fireside", value: 654, category: "semifinal"}
                    ]
                },
                {
                    name: "Quarter-Finals Eliminated",
                    children: [
                        {name: "Salted Caramel Swirl", value: 298, category: "quarterfinal"},
                        {name: "Hazelnut Heaven", value: 245, category: "quarterfinal"},
                        {name: "White Chocolate Wonder", value: 203, category: "quarterfinal"},
                        {name: "Spicy Mexican Mocha", value: 189, category: "quarterfinal"}
                    ]
                }
            ]
        };

        const momentumData = [
            {round: 1, recipe: "Dark Chocolate Decadence", votes: 276, cumulative: 276},
            {round: 2, recipe: "Dark Chocolate Decadence", votes: 512, cumulative: 788},
            {round: 3, recipe: "Dark Chocolate Decadence", votes: 678, cumulative: 1466},
            {round: 1, recipe: "Peppermint Dream", votes: 312, cumulative: 312},
            {round: 2, recipe: "Peppermint Dream", votes: 445, cumulative: 757},
            {round: 3, recipe: "Peppermint Dream", votes: 623, cumulative: 1380},
            {round: 1, recipe: "Classic Swiss Velvet", votes: 234, cumulative: 234},
            {round: 2, recipe: "Classic Swiss Velvet", votes: 398, cumulative: 632},
            {round: 1, recipe: "Cinnamon Fireside", votes: 267, cumulative: 267},
            {round: 2, recipe: "Cinnamon Fireside", votes: 387, cumulative: 654}
        ];

        const competitivenessData = [
            {match: "QF1: CSV vs SMM", margin: 45, winner: "CSV"},
            {match: "QF2: PD vs SCS", margin: 14, winner: "PD"},
            {match: "QF3: DCD vs WCW", margin: 73, winner: "DCD"},
            {match: "QF4: CF vs HH", margin: 22, winner: "CF"},
            {match: "SF1: PD vs CSV", margin: 47, winner: "PD"},
            {match: "SF2: DCD vs CF", margin: 125, winner: "DCD"},
            {match: "Final: DCD vs PD", margin: 55, winner: "DCD"}
        ];

        // Create visualizations
        createTreemap("#treemap", hierarchyData, 1500, 500);
        createMomentumChart("#momentum", momentumData, 500, 350);
        createScoreDistribution("#score-distribution", 500, 350);
        createTimeTrend("#time-trend", 500, 350);
        createCompetitivenessChart("#competitiveness", competitivenessData, 500, 350);

        function createTreemap(selector, data, width, height) {
            const svg = d3.select(selector)
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            const root = d3.hierarchy(data)
                .sum(d => d.value)
                .sort((a, b) => b.value - a.value);

            d3.treemap()
                .size([width, height])
                .padding(2)
                .round(true)(root);

            const color = d3.scaleOrdinal()
                .domain(["champion", "finalist", "semifinal", "quarterfinal"])
                .range(["#FFD700", "#FF69B4", "#87CEEB", "#DDA0DD"]);

            const cell = svg.selectAll("g")
                .data(root.leaves())
                .enter().append("g")
                .attr("transform", d => `translate(${d.x0},${d.y0})`);

            cell.append("rect")
                .attr("class", "treemap-cell")
                .attr("width", d => d.x1 - d.x0)
                .attr("height", d => d.y1 - d.y0)
                .attr("fill", d => color(d.data.category));

            cell.append("text")
                .attr("class", "treemap-label")
                .attr("x", d => (d.x1 - d.x0) / 2)
                .attr("y", d => (d.y1 - d.y0) / 2 - 5)
                .attr("text-anchor", "middle")
                .text(d => d.data.name)
                .each(function(d) {
                    const text = d3.select(this);
                    const width = d.x1 - d.x0;
                    const words = d.data.name.split(' ');
                    text.text('');
                    
                    if (width > 100) {
                        words.forEach((word, i) => {
                            text.append('tspan')
                                .attr('x', (d.x1 - d.x0) / 2)
                                .attr('dy', i === 0 ? 0 : '1.2em')
                                .text(word);
                        });
                    } else if (width > 60) {
                        text.text(d.data.name.substring(0, 12) + '...');
                    }
                });

            cell.append("text")
                .attr("class", "treemap-value")
                .attr("x", d => (d.x1 - d.x0) / 2)
                .attr("y", d => (d.y1 - d.y0) / 2 + 25)
                .attr("text-anchor", "middle")
                .text(d => `${d.data.value} votes`);
        }

        function createMomentumChart(selector, data, width, height) {
            const margin = {top: 20, right: 100, bottom: 50, left: 60};
            const chartWidth = width - margin.left - margin.right;
            const chartHeight = height - margin.top - margin.bottom;

            const svg = d3.select(selector)
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const recipes = [...new Set(data.map(d => d.recipe))];
            const color = d3.scaleOrdinal()
                .domain(recipes)
                .range(["#8B4513", "#FF69B4", "#E6E6FA", "#D2691E"]);

            const x = d3.scaleLinear()
                .domain([1, 3])
                .range([0, chartWidth]);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.cumulative)])
                .range([chartHeight, 0]);

            svg.append("g")
                .attr("transform", `translate(0,${chartHeight})`)
                .call(d3.axisBottom(x).ticks(3).tickFormat(d => `Round ${d}`));

            svg.append("g")
                .call(d3.axisLeft(y));

            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -45)
                .attr("x", -chartHeight / 2)
                .attr("text-anchor", "middle")
                .style("font-weight", "bold")
                .text("Cumulative Votes");

            const line = d3.line()
                .x(d => x(d.round))
                .y(d => y(d.cumulative));

            recipes.forEach(recipe => {
                const recipeData = data.filter(d => d.recipe === recipe);
                
                svg.append("path")
                    .datum(recipeData)
                    .attr("fill", "none")
                    .attr("stroke", color(recipe))
                    .attr("stroke-width", 3)
                    .attr("d", line);

                svg.selectAll(`.dot-${recipe.replace(/\s+/g, '-')}`)
                    .data(recipeData)
                    .enter().append("circle")
                    .attr("cx", d => x(d.round))
                    .attr("cy", d => y(d.cumulative))
                    .attr("r", 4)
                    .attr("fill", color(recipe))
                    .attr("stroke", "#fff")
                    .attr("stroke-width", 2);
            });

            const legend = svg.append("g")
                .attr("transform", `translate(${chartWidth + 10}, 0)`);

            recipes.forEach((recipe, i) => {
                const g = legend.append("g")
                    .attr("transform", `translate(0, ${i * 20})`);

                g.append("rect")
                    .attr("width", 15)
                    .attr("height", 3)
                    .attr("fill", color(recipe));

                g.append("text")
                    .attr("x", 20)
                    .attr("y", 5)
                    .style("font-size", "10px")
                    .text(recipe.split(' ').slice(0, 2).join(' '));
            });
        }

        function createScoreDistribution(selector, width, height) {
            const margin = {top: 20, right: 30, bottom: 50, left: 60};
            const chartWidth = width - margin.left - margin.right;
            const chartHeight = height - margin.top - margin.bottom;

            const recipes = [
                {name: "DCD", total: 33, avg: 8.25},
                {name: "PD", total: 31, avg: 7.75},
                {name: "CSV", total: 25, avg: 6.25},
                {name: "SCS", total: 30, avg: 7.5},
                {name: "CF", total: 30, avg: 7.5},
                {name: "WCW", total: 26, avg: 6.5},
                {name: "SMM", total: 29, avg: 7.25},
                {name: "HH", total: 28, avg: 7.0}
            ];

            const svg = d3.select(selector)
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleBand()
                .domain(recipes.map(d => d.name))
                .range([0, chartWidth])
                .padding(0.2);

            const y = d3.scaleLinear()
                .domain([0, 10])
                .range([chartHeight, 0]);

            svg.append("g")
                .attr("transform", `translate(0,${chartHeight})`)
                .call(d3.axisBottom(x));

            svg.append("g")
                .call(d3.axisLeft(y));

            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -45)
                .attr("x", -chartHeight / 2)
                .attr("text-anchor", "middle")
                .style("font-weight", "bold")
                .text("Avg Score");

            svg.selectAll(".bar")
                .data(recipes)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", d => x(d.name))
                .attr("y", d => y(d.avg))
                .attr("width", x.bandwidth())
                .attr("height", d => chartHeight - y(d.avg))
                .attr("fill", d => d.name === "DCD" ? "#FFD700" : "#69b3a2")
                .attr("stroke", "#333")
                .attr("stroke-width", 1);

            svg.selectAll(".label")
                .data(recipes)
                .enter().append("text")
                .attr("x", d => x(d.name) + x.bandwidth() / 2)
                .attr("y", d => y(d.avg) - 5)
                .attr("text-anchor", "middle")
                .style("font-size", "11px")
                .style("font-weight", "bold")
                .text(d => d.avg.toFixed(2));
        }

        function createTimeTrend(selector, width, height) {
            const margin = {top: 20, right: 30, bottom: 50, left: 60};
            const chartWidth = width - margin.left - margin.right;
            const chartHeight = height - margin.top - margin.bottom;

            const data = [
                {period: "Morning", votes: 1247, pct: 23.6},
                {period: "Afternoon", votes: 1891, pct: 35.7},
                {period: "Evening", votes: 2156, pct: 40.7}
            ];

            const svg = d3.select(selector)
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleBand()
                .domain(data.map(d => d.period))
                .range([0, chartWidth])
                .padding(0.2);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.votes) * 1.1])
                .range([chartHeight, 0]);

            svg.append("g")
                .attr("transform", `translate(0,${chartHeight})`)
                .call(d3.axisBottom(x));

            svg.append("g")
                .call(d3.axisLeft(y));

            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -45)
                .attr("x", -chartHeight / 2)
                .attr("text-anchor", "middle")
                .style("font-weight", "bold")
                .text("Votes");

            const line = d3.line()
                .x((d, i) => x(d.period) + x.bandwidth() / 2)
                .y(d => y(d.votes));

            svg.append("path")
                .datum(data)
                .attr("fill", "none")
                .attr("stroke", "#ff6b6b")
                .attr("stroke-width", 3)
                .attr("d", line);

            svg.selectAll(".dot")
                .data(data)
                .enter().append("circle")
                .attr("cx", d => x(d.period) + x.bandwidth() / 2)
                .attr("cy", d => y(d.votes))
                .attr("r", 6)
                .attr("fill", "#ff6b6b")
                .attr("stroke", "#fff")
                .attr("stroke-width", 2);

            svg.selectAll(".label")
                .data(data)
                .enter().append("text")
                .attr("x", d => x(d.period) + x.bandwidth() / 2)
                .attr("y", d => y(d.votes) - 15)
                .attr("text-anchor", "middle")
                .style("font-size", "12px")
                .style("font-weight", "bold")
                .text(d => `${d.votes} (${d.pct}%)`);
        }

        function createCompetitivenessChart(selector, data, width, height) {
            const margin = {top: 20, right: 30, bottom: 80, left: 60};
            const chartWidth = width - margin.left - margin.right;
            const chartHeight = height - margin.top - margin.bottom;

            const svg = d3.select(selector)
                .append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleBand()
                .domain(data.map(d => d.match))
                .range([0, chartWidth])
                .padding(0.2);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d.margin) * 1.2])
                .range([chartHeight, 0]);

            svg.append("g")
                .attr("transform", `translate(0,${chartHeight})`)
                .call(d3.axisBottom(x))
                .selectAll("text")
                .attr("transform", "rotate(-45)")
                .style("text-anchor", "end")
                .style("font-size", "10px");

            svg.append("g")
                .call(d3.axisLeft(y));

            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", -45)
                .attr("x", -chartHeight / 2)
                .attr("text-anchor", "middle")
                .style("font-weight", "bold")
                .text("Vote Margin");

            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("x", d => x(d.match))
                .attr("y", d => y(d.margin))
                .attr("width", x.bandwidth())
                .attr("height", d => chartHeight - y(d.margin))
                .attr("fill", d => d.margin < 30 ? "#ff6b6b" : d.margin < 60 ? "#ffd93d" : "#6bcf7f");

            svg.selectAll(".label")
                .data(data)
                .enter().append("text")
                .attr("x", d => x(d.match) + x.bandwidth() / 2)
                .attr("y", d => y(d.margin) - 5)
                .attr("text-anchor", "middle")
                .style("font-size", "11px")
                .style("font-weight", "bold")
                .text(d => d.margin);
        }
    </script>
</body>
</html>
